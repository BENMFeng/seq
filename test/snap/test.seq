from sys import argv
from genomeindex import *
type K = k20

def process(index: GenomeIndex[K], kmer: K):
    checksum = u32(0)
    hits = index[kmer]
    hits_rev = index[~kmer]

    for i in range(len(hits)):
        checksum ^= hits[i]

    for i in range(len(hits_rev)):
        checksum ^= hits_rev[i]

    return checksum

def main(args: array[str]):
    index = GenomeIndex[K](args[0])
    step = K.len()
    checksum = u32(0)

    for read in FASTQ(args[1]):
        for kmer in read.kmers[K](step):
            checksum ^= process(index, kmer)

    print 'CHECKSUM:', int(checksum)

if len(argv) > 0:
    main(argv)
